---
title: "Analiza nogometnega trga in prihodki klubov"
author: "Matevž Raspet"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Pri tem projektu bom analiziral nogometni trg v zadnjih letih in sicer gibanje višine najbolj odmevnih prestopov leta, gibanje tržnih cen igralcev,  vrednost igralcev glede na pozicijo, vrednost cene igralca glede na starost in pa gibanje prihodkov nogometnih klubov. Skratka zanimalo me bo obnašanje nogometnega trga, ki vemo, da je sedaj zelo v razcvetu, saj so cene prestopov, plače ...,  "poletele" astronomsko v nebo.

Poskušal bom ugotoviti trende, kakšno je spreminjanje tržnih vrednosti igralcev. Za primer bom vzel enega izmed najboljših nogometašev na svetu, Lionela Messija, in bom pogledal kako starost in nogometna učinovitost vplivata na vrednost igralca. Nato bom v večji bazi igralcev pogledal katera leta so za igralce najbolj donosna. Na koncu pa bom poskušal dobiti še nekaj zanimivih zaključkov iz nemške lige.


***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozil sem podatke  v obliki CSV s statističnega urada ter v obliki HTML
z Wikipedije. Podatke imam v petih razpredelnicah v obliki *tidy data*.

1. `Igralci` - podatki o igralcih glede na pozicijo
  - `pozicija` - spremenljivka: igralna pozicija igralca,
  - `starost` - meritev: starost igralca,
  - `vrednost` - meritev: vrednost igralca,
  - `država` - spremenljivka: narodnost igralca,
  - `klub` - spremenljivka: klub za katerega igra igralec.
  
2. `Statistika` - statistika igralcev glede na ceno
  - `vrednost` - spremenljivka: vrednost igralca,
  - `starost` - spremenljivka: starost igralca,
  - `odigrane tekme` - meritev: št.odigranih tekem,
  - `zadeti goli` - meritev. št. danih golov posameznega igralca,
  - `avtogoli` - meritev: število danih avtogolov posameznega igralca,
  - `rumeni karton`- meritev: št.prejetih rumenih kartonov,
  - `drugi rumeni karton` - meritev: št. prejetih drugih rumenih kartonov na eni tekmi,
  - `rdeči karton` - meritev: št. prejetih rdečih kartonov,
  - `prišel kot menjava` - meritev: št.tekem, ko je igralec prišel kot menjava,
  - `odšel na klop` - meritev: št. tekem, ko je bil igralec zamenjan.

3. `Messi` - statistika Lionela Messija
  - `sezona` - spremenljivka: sezona igranja,
  - `starost` - spremenljivka: starost Messija v določeni sezoni,
  - `vrednost` - meritev: tržna vrednost Messija,
  - `goli` - meritev: število danih golov,
  - `asistence` - meritev: število asistenc.
  
  
4. `Nemška liga` - obisk prvoligaških tekem
  - `klub` - spremenljivka: nemški prvoligaški klub,
  - `pokrajina` - spremenljivka: pokrajina v kateri je nemški prvoligaš,
  - `število tekem` - meritev: st. gostujočih prvoligaskih tekem posameznega kluba v sezoni,
  - `povprečje` - meritev: povprečen obisk na tekmi,
  - `obisk skupaj` - meritev: število prodanih vstopnic za domače tekme tekom cele sezone
  
5. `Plače` - povprečne plače po občinah Slovenije
  - `leto` - spremenljivka: leto, katerega so bile narejene meritve,
  - `dohodek` - meritev: velikost plače

**Opomba**: da bi razpredelnica `obcine` res bila v obliki *tidy data*, bi morali odstraniti stolpec `gostota` (saj je izpeljan iz stolpcev `povrsina` in `prebivalci`), podatke o pokrajinah pa bi morali premakniti v drugo razpredelnico, saj nekatere občine pripadajo dvema pokrajinama. Podobno bi morali narediti tudi s stolpcem `odcepitev`.

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x = naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data = left_join(zemljevid, povprecja, by = c("OB_UIME" = "obcina")),
                        aes(x = long, y = lat, group = group, fill = povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill = guide_colorbar(title = "Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina = names(skupine),
                                     skupina = factor(skupine)), by = "obcina")
, aes(x = povrsina, y = naselja, color = skupina, size = prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color = guide_legend(title = "Skupina"),
         size = guide_legend(title = "Prebivalci (* 1000)"))
```

***

```{r shiny, echo = FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
